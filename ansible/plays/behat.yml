---
- hosts: localhost
  tasks:
    - name: Install Behat dependencies
      apt:
        name: "{{ item }}"
        state: installed
      with_items:
        - php5-curl
        - openjdk-7-jre-headless
    - name: Download Selenium
      get_url:
        url: http://selenium-release.storage.googleapis.com/2.52/selenium-server-standalone-2.52.0.jar
        dest: "{{ root }}/selenium-server.jar"
        mode: 0555
      when: vagrant == 'true'
    - name: Install Composer
      shell: "curl -s https://getcomposer.org/installer | php"
      args:
        chdir: "{{ root }}"
        creates: "{{ root }}/composer.phar"
    - name: Install Behat
      shell: "{{ root }}/composer.phar install"
      args:
        chdir: "{{ root }}"
        creates: "{{ root }}/bin/behat"
    - name: Install drush-bde-env
      git:
        repo: https://github.com/pfrenssen/drush-bde-env.git
        dest: ~/.drush/drush-bde-env
      notify:
      - Clear Drush cache
    - meta: flush_handlers
    - name: Generate Behat parameters
      shell: "drush beg --subcontexts=profiles/{{ profile }}/modules --site-root={{ drupal_dir }} --skip-path-check {{root}}/behat_params.sh"
      args:
        chdir: "{{ drupal_dir }}"
        creates: "{{ root }}/behat_params.sh"


  handlers:
    - name: Clear Drush cache
      shell: drush cc drush
